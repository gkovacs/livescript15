function in$(e,t){for(var n=-1,r=t.length>>>0;++n<r;)if(e===t[n])return!0;return!1}function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}function repeatString$(e,t){for(var n="";t>0;(t>>=1)&&(e+=e))1&t&&(n+=e);return n}function clone$(e){function t(){}return t.prototype=e,new t}function compose$(){var e=arguments;return function(){var t,n;for(n=e[0].apply(this,arguments),t=1;t<e.length;++t)n=e[t](n);return n}}var LiveScript,path,fs,util,prelude,each,breakList,lines,unlines,take,keys,filter,dasherize,map,ref$,parseOptions,generateHelp,nameFromPath,SourceNode,version,this$=this,slice$=[].slice;LiveScript=require(".."),path=require("path"),fs=require("fs"),util=require("util"),prelude=require("prelude-ls"),each=prelude.each,breakList=prelude.breakList,lines=prelude.lines,unlines=prelude.unlines,take=prelude.take,keys=prelude.keys,filter=prelude.filter,dasherize=prelude.dasherize,map=prelude.map,ref$=require("./options"),parseOptions=ref$.parse,generateHelp=ref$.generateHelp,nameFromPath=require("./util").nameFromPath,SourceNode=require("./source-map").SourceNode,version=LiveScript.VERSION,function(e){return module.exports=e}(function(e,t){function n(e,t,n){fs[e](t,function(e,t){e&&g(e.stack||e),n(t)})}function r(){function e(t,r,o){function c(){n("readFile",t,function(e){i(t,e+"",r)})}fs.stat(t,function(i,u){if(i)return o&&!/(?:\.ls|\/)$/.test(t)||g("Can't find: "+t),void e(t+".ls",r);if(u.isDirectory()){if(!$.run)return void n("readdir",t,function(n){n.forEach(function(n){e(t+"/"+n,r)})});t+="/index.ls"}(o||".ls"===t.slice(-3))&&($.watch?s(t,c):c())})}x.forEach(function(t){e(t,path.normalize(t),!0)})}function i(e,t,n){var r,i,o,c,s,p,f;r={filename:e,outputFilename:a(e,$.json),bare:$.bare,const:$.const,map:$.map,header:$.header},i={input:t,options:r};try{if($.lex||$.tokens||$.ast){if(LiveScript.emit("lex",i),i.tokens=LiveScript.tokens(i.input,{raw:$.lex}),$.lex||$.tokens)throw l(i.tokens),null;throw LiveScript.emit("parse",i),i.ast=LiveScript.ast(i.tokens),m($.json?i.ast.stringify(2):"".trim.call(i.ast)),null}if(o=$.json||/\.json\.ls$/.test(e),c=$.run||$.eval){switch(LiveScript.emit("compile",i),s=o||$.print,i.output=LiveScript.compile(i.input,(p={},import$(p,r),p.bare=!0,p.run=c,p.print=s,p)),LiveScript.emit("run",i),i.result=LiveScript.run("none"===$.map?i.output:i.output.code,r,{js:!0,context:$.runContext}),!1){case!o:m(JSON.stringify(i.result,null,2));break;case!$.print:m(i.result)}throw null}LiveScript.emit("compile",i),i.output=LiveScript.compile(i.input,(p={},import$(p,r),p.json=o,p.print=$.print,p)),LiveScript.emit("write",i),$.print||!e?m(("none"===$.map?i.output:i.output.code).trimRight()):u(e,i.output,i.input,n,o)}catch(t){if(f=t,null!=f)return void(LiveScript.listeners("failure").length?LiveScript.emit("failure",f,i):(e&&v("Failed at: "+e),f instanceof SyntaxError||/^Parse error /.test(f.message)||(f=f.stack||f),$.watch?v(f.message+""):g(f)))}LiveScript.emit("success",i)}function o(e){var t,n;t=process.openStdin(),n="",t.on("data",function(e){n+=e}),t.on("end",function(){e(n)}),t.on("data",function(){var r;"\r\n"!==(r=n.slice(-3))&&"\r\n"!==r||(e(n.slice(0,-3)),t.destroy())})}function c(){o(function(e){i("",e)})}function s(e,t){(function r(i){n("stat",e,function(e){var n;n=e.mtime,i^n&&t(),setTimeout(r,500,n)})}).call(this,0)}function u(e,t,n,r,i){function o(){fs.writeFile(p,t.toString()||"\n",function(t){return t?v(t):void(($.watch||$.debug)&&h(e+" => "+p))})}function c(){fs.writeFile(p,t.code||"\n",function(n){var r;return n?v(n):void("linked"===$.map||"debug"===$.map?(r=p+".map",fs.writeFile(r,t.map||"\n",function(n){return n?v(n):void("debug"===$.map?fs.writeFile(r+".debug",t.debug||"\n",function(t){($.watch||$.debug)&&h(e+" => "+p+", "+r+"[.debug]")}):($.watch||$.debug)&&h(e+" => "+p+", "+r))})):($.watch||$.debug)&&h(e+" => "+p))})}var s,u,l,p;s=a(e,i),u=path.dirname(e),(l=$.output)&&(u=path.join(l,u.slice("."===r?0:r.length))),e=path.normalize(e),p=path.join(u,s),fs.stat(u,function(e){if("none"!==$.map){if(!e)return c()}else if(!e)return o();require("child_process").exec("mkdir "+[/^win/.test(process.platform)?void 0:"-p"]+" "+u,o)})}function a(e,t){return path.basename(e).replace(/(?:(\.\w+)?\.\w+)?$/,function(){return arguments[1]||(t?".json":".js")})}function l(e){var t,n,r,i,o,c,s,u;for(t=[],n=0,r=e.length;n<r;++n)i=e[n],o=i[0],c=i[1],s=i[2],(null!=(i=t[s])?i:t[s]=[]).push(o.toLowerCase()===c?o:o+":"+c);for(n=0,r=t.length;n<r;++n)u=t[n],m(u?u.join(" ").replace(/\n/g,"\\n"):"")}function p(){var e,t,n,r,i,o,c,s,u,a,l,f,d;e=500,t=path.join(process.env.HOME,"/.lsc_history"),n=p.infunc?"  ":"",r=0,i=require("readline").createInterface(process.stdin,process.stdout),o=function(){i.line=n="",i.prompt(),p.inheredoc=!1},(c=i._ttyWrite,i)._ttyWrite=function(e){return"\n"===e||">"===e?r+=1:r=0,c.apply(this,arguments)},s="ls",(u=repeatString$("b",!!$.bare)+repeatString$("c",!!$.compile))&&(s+=" -"+u);try{i.history=lines(fs.readFileSync(t,"utf-8").trim())}catch(e){}null!=LiveScript&&(LiveScript.history=i.history),$.compile||(module.paths=module.constructor._nodeModulePaths(module.filename=process.cwd()+"/repl"),a=require("vm"),$.prelude&&import$(global,prelude),l={},import$(l,global),l.module=module,l.exports=exports,l.require=require,l.LiveScript=LiveScript,l.path=path,l.fs=fs,l.util=util,l.say=m,l.warn=v,l.die=g,l.p=S,l.pp=b,l.ppp=y,d=clone$(require("repl").REPLServer.prototype),d.context=l,d.commands=[],d.useGlobal=!0,d.useColors=process.env.NODE_DISABLE_COLORS,d.eval=function(e,t,n,r){var i,o;try{i=a.runInNewContext(e,t,"repl")}catch(e){o=e}r(o,i)},f=d,i.completer=function(e,t){var n,r;return n=map(L,keys(f.context)),r=filter(k(e),n),t(null,[r.length?r:n,e])}),i.on("SIGCONT",i.prompt),i.on("SIGINT",function(){this.line||n?(m(""),o()):this.close()}),i.on("close",function(){return m(""),process.exit()}),i.on("line",function(e){var t,c,u,f;if(e.match(/^$/)&&(p.infunc=!1),(e.match(/(\=|\~>|->|do|import|switch)\s*$/)||e.match(/^!?(function|class|if|unless) /)&&!e.match(/ then /))&&(p.infunc=!0),(0<r&&r<3||p.infunc)&&!p.inheredoc)return n+=e+"\n",void this.output.write(repeatString$(".",s.length)+". ");if(t=e.match(/(\'\'\'|\"\"\")/g),t&&t.length%2===1&&(p.inheredoc=!p.inheredoc),p.inheredoc)return n+=e+"\n",void i.output.write(repeatString$(".",s.length)+'" ');if(p.inheredoc=!1,!(n+=e))return o();try{$.compile?m(LiveScript.compile(n,{bare:$.bare})):(c={eval:"eval",bare:!0,saveScope:LiveScript},n.match(/^\s*!?function/)&&(c={bare:!0}),u=a.runInNewContext(LiveScript.compile(n,c),l,"repl"),null!=u&&(l._=u),b(u),"function"==typeof u&&m(u))}catch(e){f=e,m(f)}o()}),process.on("uncaughtException",function(e){m("\n"+((null!=e?e.stack:void 0)||e))}),process.on("exit",function(){n&&i.output.isTTY&&i._ttyWrite("\r"),w(t)&&fs.writeFileSync(t,compose$(take(e),unlines)(i.history))}),i.setPrompt(s+"> "),i.prompt()}function f(){var e,t,n,r,i;e=process.argv,t=slice$.call(e,1),e=breakList(function(e){return"--nodejs"===e||"-n"===e},t),n=e[0],r=e[1],i=slice$.call(r,1),require("child_process").spawn(process.execPath,i.concat(n),{cwd:process.cwd(),stdio:"inherit"})}var d,m,h,v,g,S,b,y,w,L,k,$,x,j,q,O,F,_,N;d=null!=t?t:{},m=d.say,h=d.sayWithTimestamp,v=d.warn,g=d.die,null==m&&(m=console.log),null==h&&(h=util.log),null==v&&(v=console.error),null==g&&(g=function(e){console.error(e),process.exit(1)}),S=function(){var e,t,n,r;for(t=[],n=0,r=arguments.length;n<r;++n)t.push(arguments[n]);e=t,each(console.dir,e)},b=function(e,t,n){m(util.inspect(e,t,n,!process.env.NODE_DISABLE_COLORS))},y=function(e){b(e,!0,null)},w=function(e){try{return fs.statSync(e),!0}catch(e){}},L=function(e){return/^[a-z]/.exec(e)?dasherize(e):e},k=function(e){return function(t){return 0===t.indexOf(e)}};try{$=parseOptions(e),x=$._}catch(e){j=e,g(j.message)}switch(!1){case!$.nodejs:f();break;case!$.version:m("LiveScript version "+version);break;case!$.help:m(generateHelp({interpolate:{version:version}}));break;default:switch(q=["none","linked","linked-src","embedded","debug"],in$($.map,q)||g("Option --map must be either: "+q.join(", ")),$.run=!($.compile||($.compile=$.output)),e===process.argv&&(process.argv[0]=process.argv[1],O=$.stdin?x:$.run?x.splice(1,9e9):[],(d=process.argv).splice.apply(d,[2,9e9].concat(slice$.call(O)))),(F=$.require)&&(_=module.filename,module.filename=".",each(function(e){return global[nameFromPath(e)]=require(e)})(F),module.filename=_),!1){case!$.eval:N=function(e){$.prelude&&import$(global,prelude),$.runContext=JSON.parse(e.toString()),i("",$.eval)},x.length&&($.json||/\.json$/.test(x[0]))?($.json=!0,n("readFile",x[0],N)):$.json?o(N):i("",$.eval);break;case!$.stdin:c();break;case!x.length:r();break;case!require("tty").isatty(0):m("LiveScript "+version+" - use 'lsc --help' for more information"),p();break;default:c()}}});